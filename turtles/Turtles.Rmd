---
title: "Eggs Laid and Nests Harvested of Kemp's Ridley Sea Turtles in Ostional, Costa Rica, Period 2006-2010"
author: "Jose Francisco Nuñez Obando (<https://geoimaginarte.github.io/mysite>)<br> (Profesor: Wagner Quiros-Pereira ENV S193ST)" 
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
  ioslides_presentation:
    widescreen: true
    smaller: true
    incremental: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

setwd("E:/Trabajos Fran/Ostional")
```

## About this Document

This is an R Markdown presentation and it is created using Rstudio.

RStudio is an integrated development environment (IDE) for R. RStudio is available in open source and commercial editions and runs on the desktop (Windows, Mac, and Linux).

R is a language and environment for statistical computing and graphics. R provides a wide variety of statistical (linear and nonlinear modelling, classical statistical tests, time-series analysis, classification, clustering, …) and graphical techniques, and is highly extensible. R is available as Free Software.

## Steps

> - Determine the libraries to use
> - Read the file and transform the data
> - Select the more appropriate kind of chart to represent the information
> - Create a dynamic time series chart

## Libraries Used {.smaller}

R packages are a collection of R functions, compiled code and sample data. They are stored under a directory called "library" in the R environment. By default, R installs a set of packages during installation. More packages are added later when they are needed for some specific purpose.

```{r warning=FALSE, message=FALSE, echo = TRUE}

library(readxl) #Read the data from excel sheet
library(DT) #Show a dynamic table
library(ggplot2) #Create Charts
library(xts) #Create Time Series
library(highcharter) #Represent the data in timeseries chart
library(imager) #Open image

```

## Load the Table and any other Changes in Data 

```{r echo = TRUE}

#Load the table, establishing the sheet, range and column types of the data

Turtle <- read_excel("Turtles.xlsx", 
                     sheet = "Chart", range = cell_cols("A:C"), 
                     col_types = c("date","numeric", "numeric")) 

#Change column names

names(Turtle)[2] <- "egglaying"
names(Turtle)[3] <- "nharv"

```

## Create a visualization of the Table

```{r echo = TRUE}

table <- datatable(Turtle, extensions = c('Buttons','FixedColumns', 'RowReorder'),
  filter = list(position = 'top', clear = FALSE),
  options = list(dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel', 'pdf', 'print'), dom = 't',
    scrollX = TRUE,
    fixedColumns = TRUE,
    rowReorder = TRUE, order = list(c(0 , 'asc'))))

```

## Consult the Table

```{r}
table
```

## Summary of the data

```{r echo = TRUE}
summary(Turtle[,2:3])
```

## Create the Time Series Chart

```{r echo = TRUE}

#Create chart using ggplot tools

Chart_1 <- Turtle %>% ggplot() + 
  geom_bar(mapping = aes(x = as.Date(Date, "%Y-%m", tz = "UTC"), y = egglaying, group = 2, size = "Eggs Laying"), 
           stat = "identity", colour = "#2F528F", fill = "#2F528F") +
  scale_size_manual(NULL, values = 0.5) +
  geom_point(mapping = aes(x = as.Date(Date, "%Y-%m", tz = "UTC"), 
            y = nharv * 500000/100, group = 1, color = "Nest harvested"), size = 3, 
            shape = 21, fill = "#ED7D31", inherit.aes = FALSE) +
  geom_line(mapping = aes(x = as.Date(Date, "%Y-%m", tz = "UTC"), 
            y = nharv * 500000/100, group = 1, color = "Nest harvested"), colour="#ED7D31", inherit.aes = FALSE) +
  scale_color_manual(NULL, values = "#ED7D31") +
  scale_x_date(date_labels = "%b-%Y", date_breaks = "6 months") +
  scale_y_continuous(
    name = "Egg Laying Females (total number)", 
    sec.axis = sec_axis(~. * 100/500000, name="Nests Harvested (percent)"),
    limits = c(0, 500000)) +  xlab("Date") +
  ggtitle("Total number of Egg Laying Females and Percent of Nests Harvested
       Ostional - Costa Rica, Period 2006-2010") + theme_bw() +
  theme(panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank(), 
    legend.position="top", 
    legend.background = element_rect(fill = "transparent"), 
    legend.box.background = element_rect(fill = "transparent", colour = NA),
    legend.key = element_rect(fill = "transparent"), 
    legend.spacing = unit(-1, "lines"))


```

## Time Series Chart

```{r}
Chart_1
```


## Create the Time Series Vectors 

A time series chart, also called a times series graph or time series plot, is a data visualization tool that illustrates data points at successive intervals of time. Each point on the chart corresponds to both a time and a quantity that is being measured.

```{r echo = TRUE}
# Change dataset to Time Series format

Turtle.ts.eggs <- xts(Turtle$egglaying, Turtle$Date)
Turtle.ts.nest <- xts(Turtle$nharv, Turtle$Date)

```


## Create the Time Series Dynamic Chart

```{r echo = TRUE}

#Create the Time Series Chart

Chart_2 <- highchart(type = "stock") %>% 
  hc_title(text = "Total number of Egg Laying Females and Percent of Nests Harvested
       <br>Ostional - Costa Rica, Period 2006-2010</br>") %>% 
  hc_subtitle(text = "Figure Adapted from: Valverde et al. 2012") %>% 
  hc_yAxis_multiples(list(title = list(text = "Egg Laying Females (total number)"), opposite = FALSE),
      list(showLastLabel = FALSE, opposite = TRUE, title = list(text = "Nests Harvested (percent)"))) %>% 
  hc_add_series(Turtle.ts.eggs,  yAxis = 0, type = "column", 
      pointInterval= 30*24*3600*1000, name="Egg Laying Females", color = "#2F528F")%>%
  hc_add_series(Turtle.ts.nest,  yAxis = 1, type = "spline", 
      pointInterval= 30*24*3600*1000, name="Percentage of Nests Harvested", color = "#ED7D31")%>%
  hc_plotOptions(spline = list(marker = list(enabled = TRUE, radius = 4))) %>% 
  hc_xAxis(title= list(text='Date'), type='datetime')
```

## Time Series Dynamic Chart

```{r}
Chart_2
```

## Figure Adapted from: Valverde et al. 2012

```{r echo = TRUE}

im <- load.image("chart2.jpg")
im %>% plot(axes=F)

```




